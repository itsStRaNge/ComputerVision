function im_synth = synthesis_one_side(disp_map,leftrgb,rightrgb,p)
    im_synth=zeros(size(leftrgb));
    %{
    %Fill in background with pixels from second image.
    for i=1:size(leftrgb,1)
        for j=1:size(leftrgb,2)
            new_x=j-round((disp_map(i,j)*(1-p)));
            if(new_x<=0)
                im_synth(i,j,:)=[0,0,0];  
            else
                im_synth(i,j,:)=rightrgb(i,new_x,:);
            end
        end
    end
    %}
    %fill in foreground with moved pixels from first image
    
    rowvls=1:size(leftrgb,2);
    
    m=repmat(rowvls,size(leftrgb,1),1);
    m=int16(m);
    
    new_x=m-disp_map.*p;
    im_synth=zeros(size(leftrgb,1),size(leftrgb,2));
    new_x(new_x<0 | new_x > size(leftrgb,2))=m(new_x<0 | new_x > size(leftrgb,2));
    
    new_x=uint16(new_x);
    m=repelem(1:size(leftrgb,2),size(leftrgb,1));
    
    
    leftrgb=leftrgb(:);
    
    
    
    
    
    for i=1:size(leftrgb,1)
        for j=1:size(leftrgb,2)
            new_x=round(j-disp_map(i,j)*p);
            
            
            if(new_x>0 && new_x < size(leftrgb,2))
                im_synth(i,new_x,:)=leftrgb(i,j,:);
                zz = repelem(squeeze(im_synth(i,new_x,:)),(j-new_x+1));
                im_synth(i,new_x:j,:)=reshape(zz, size(im_synth(i,new_x:j,:)));     
            end
        end
    end
    im_synth=uint8(im_synth);
end
