
leftrgb=imread('imL.png');                   %left image
rightrgb=imread('imR.png');  
leftrgb=imresize(leftrgb,0.5);
rightrgb=imresize(rightrgb,0.5);%right image

left_disp=disparity_segmentation(leftrgb,rightrgb);

v=VideoWriter('test_sequence.avi');
open(v);
clear norm;
for p=0:0.02:1
    im_synth=zeros(size(leftrgb));
    for i=1:size(leftrgb,1)
        for j=1:size(leftrgb,2)
            
        end
    end
    
    for i=1:size(leftrgb,1)
        for j=1:size(leftrgb,2)
            new_x=round(j-left_disp(i,j)*p);
            if(new_x>0 && new_x < size(leftrgb,2))
                im_synth(i,new_x,:)=leftrgb(i,j,:);
            end
        end
    end
    im_filler=zeros(size(leftrgb));
    
    for i=1:size(leftrgb,1)
        for j=1:size(leftrgb,2)
            if(im_synth(i,j,1)==0 && im_synth(i,j,2)==0 && im_synth(i,j,3)==0)
                im_filler(i,j,:)=(leftrgb(i,j,:)+p*rightrgb(i,j,:))/2;
            end
        end
    end
    temp=im_filler(:,:,1)+im_filler(:,:,2)+im_filler(:,:,3);
    im_filler=imgaussfilt(im_filler,2);
    im_filler(temp==0)=0;
    im_synth=im_synth+im_filler;
    im_synth=uint8(im_synth);
    writeVideo(v,im_synth);
end
close(v);